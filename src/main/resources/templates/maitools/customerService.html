
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/main_layout}">
    <head>
        <title layout:title-pattern="Cilantro ~ CUSTOMER SERVICE">CUSTOMER SERVICE</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <div layout:fragment="pageStyle" th:remove="tag">
        <style>
            #loading {
                background: url('/assets/images/ajax-loader.gif') no-repeat center center;
                position: absolute;
                top: 0;
                left: 0;
                height: 92%;
                width: 100%;
                z-index: 9999999;
            }
            ;
            #rtgsTxnOnWorkFlow{
                table-layout: fixed !important;
                word-wrap:break-word;
            }
        </style>
        <link th:href="@{/assets/plugins/datatables/jquery.dataTables.min.css}" rel="stylesheet" type="text/css"/>
        <link th:href="@{/assets/plugins/datatables/buttons.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
        <link th:href="@{/assets/plugins/datatables/responsive.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
        <link th:href="@{/assets/plugins/datatables/scroller.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
        <link th:href="@{/assets/plugins/datatables/dataTables.colVis.css}" rel="stylesheet" type="text/css"/>
        <link th:href="@{/assets/plugins/datatables/dataTables.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
        <link th:href="@{/assets/plugins/datatables/fixedColumns.dataTables.min.css}" rel="stylesheet" type="text/css"/>
        <link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet">
        <link th:href="@{/assets/plugins/timepicker/bootstrap-timepicker.min.css}" rel="stylesheet">
        <link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet">


    </div>
</head>
<body>

    <div class="row" layout:fragment="contents">
        <div class="panel panel-default panel-fill" id="tabContentsss"><div class="panel-heading"> <h4 class="panel-title" >CUSTOMER SERVICE</h4></div>
            <form role="form"  th:action="@{/fireCusTomerServicePrint}" method="post">
                <div class="panel-body">
                    <div class="row">
                        <div class="row">
                            <div class="form-group col-md-6">
                                <input name="account" id="account"  class="form-control"   type="text" placeholder="Customer Account Number" required/>
                            </div>
                            <div class="form-group col-md-6">
                                <button  type="button" class="btn btn-info btn-click" >Query Customer</button>
                            </div>
                        </div>
                    </div>
                    <div id="successFlag">
                    </div>
                    <div class="row">
                        <div id="custInfo" class="col-md-12">
                        </div>
                    </div>
                    <hr/>
                    <div class="alert alert-info" style="font-size:16px">
                        <p>Confirm the customer information and  Click <strong>PRINT</strong></p>
                                    <p>Balance charge: <strong>1,000/=</strong> or usd equivalent</p>
                                    <p>Statement Per page charge: <strong>2000/=</strong> or usd equivalent</p>
                                    </div>
                                    <div class="row" style="display:none;" id="actionPrint">
                                        <div class="col-md-12">
                                            <div class="row">
                                                <div class="form-group col-md-4">
                                                    <div class="input-group">
                                                        <select class="form-control" id="ttype"  name="ttype">
                                                            <option value="X1" selected="">BALANCE</option>
                                                            <option value="X2">STATEMENT</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4">
                                                    <input name="startDate" id="datepicker-autoclose"  th:value="${startDate}"  class="form-control"   type="text" placeholder="Start date"/>
                                                </div>
                                                <div class="form-group col-md-4">
                                                    <input name="endDate" id="datepicker-autoclose2"  th:value="${endDate}"  class="form-control"   type="text" placeholder="End date"/>
                                                </div>
                                                <div class="form-group col-md-4">
                                                    <button  type="button" class="btn btn-success btn-charge" >Calculate Charge AMOUNT</button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                                    <div id="calculatedCharge" class="alert alert-success" style="font-size:16px; display: none;" >

                                    </div>
                                    <hr/>
                                    <div class="form-group col-md-4" style="display:none" id="printButton">
                                        <button  type="button" class="btn btn-warning btn-print" >PRINT</button>
                                    </div>
                                    </div>
                                    </form>
                                    </div>
                                    </div>
                                    <div layout:fragment="pageScript" th:remove="tag">
                                        <script th:src="@{/assets/plugins/datatables/jquery.dataTables.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/dataTables.bootstrap.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/dataTables.buttons.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/buttons.bootstrap.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/jszip.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/pdfmake.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/vfs_fonts.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/buttons.html5.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/buttons.print.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/dataTables.keyTable.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/dataTables.responsive.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/responsive.bootstrap.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/dataTables.scroller.min.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/dataTables.colVis.js}"></script>
                                        <script th:src="@{/assets/plugins/datatables/dataTables.fixedColumns.min.js}"></script>
                                        <!-- init -->
                                        <script th:src="@{/assets/pages/jquery.datatables.init.js}"></script>
                                        <script th:src="@{/assets/plugins/moment/moment.js}"></script>
                                        <script th:src="@{/assets/plugins/timepicker/bootstrap-timepicker.js}"></script>
                                        <script th:src="@{/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js}"></script>

                                        <!-- App Js -->
                                        <script th:src="@{/assets/js/jquery.app.js}"></script>
                                        <script th:src="@{/assets/plugins/select2v4/select2.min.js}"></script>
                                        <script th:src="@{/assets/scripts/teller.js}"></script>
                                        <script th:src="@{/assets/scripts/eft.js}"></script>
                                        <script>
                                            $(document).ready(function () {
                                                jQuery('#fromTime').timepicker({
                                                    showMeridian: false
                                                });
                                                jQuery('#toTime').timepicker({
                                                    showMeridian: false
                                                });
                                                jQuery('#datepicker-autoclose').datepicker({
                                                    autoclose: true,
                                                    todayHighlight: true,
                                                    format: 'yyyy-mm-dd'
                                                });
                                                jQuery('#datepicker-autoclose2').datepicker({
                                                    autoclose: true,
                                                    todayHighlight: true,
                                                    format: 'yyyy-mm-dd'
                                                });
                                                $("#loading").hide();

                                                $('.btn-click').click(function () {
                                                    viewSummary();
                                                });

                                                $('.btn-charge').click(function () {
                                                    calculateCharge();
                                                });
                                                $('.btn-print').click(function () {
                                                    generateJasperReport();
                                                });

                                                //            });
                                            }
                                            );

                                            function viewSummary() {
                                                // get the form values
                                                var token = $("meta[name='_csrf']").attr("content");
                                                var header = $("meta[name='_csrf_header']").attr("content");
                                                var formdata = new FormData();
                                                formdata.append('account', $("input[name='account']").val());
                                                if ($("input[name='account']").val() == '') {
                                                    alert('Account is required');
                                                    return;
                                                }
                                                $.ajax({
                                                    processData: false,
                                                    contentType: false,
                                                    data: formdata,
                                                    type: "POST",
                                                    url: "/fireCusTomerServiceAjax",
                                                    beforeSend: function (request) {
                                                        $('#actionPrint').hide();
                                                        request.setRequestHeader(header, token);
                                                        $('#loading1').show();

                                                    },
                                                    success: function (response) {
                                                        $('#loading1').hide();

                                                        $("#custInfo").html(response);
                                                        if (response.indexOf("Account does not exist.") != -1) {
                                                            console.log('Account does not exist.');
                                                        } else {
                                                            $('#actionPrint').show();
                                                        }
                                                    },
                                                    error: function (e) {
                                                        console.log(e);
                                                    }
                                                });

                                            }


                                            function calculateCharge() {
                                                // get the form values
                                                var token = $("meta[name='_csrf']").attr("content");
                                                var header = $("meta[name='_csrf_header']").attr("content");
                                                var formdata = new FormData();
                                                formdata.append('account', $("input[name='account']").val());
                                                formdata.append('ttype', $("#ttype").val());
                                                formdata.append('startDate', $("input[name='startDate']").val());
                                                formdata.append('endDate', $("input[name='endDate']").val());
                                                $.ajax({
                                                    processData: false,
                                                    contentType: false,
                                                    data: formdata,
                                                    type: "POST",
                                                    url: "/fireCusTomerServiceCalculate",
                                                    beforeSend: function (request) {
                                                        $('#loading1').show();
                                                        request.setRequestHeader(header, token);
                                                    },
                                                    success: function (response) {
                                                        $('#loading1').hide();

                                                        console.log(response);
                                                        if (response.status == '0') {
                                                            $('#printButton').show();
                                                        }
                                                        $("#calculatedCharge").html(response.msg);
                                                        $("#calculatedCharge").show();

                                                    },
                                                    error: function (e) {
                                                        console.log(e);
                                                    }
                                                });

                                            }
                                            function generateJasperReport() {

                                                var account = $("input[name='account']").val();
                                                var ttype = $("#ttype").val();
                                                var startDate = $("input[name='startDate']").val();
                                                var endDate = $("input[name='endDate']").val();
                                                window.open('/fireCusTomerServicePrint/' + account + '/' + startDate + '/' + endDate + '/' + ttype, '_blank');
                                            }
                                        </script>
                                    </div>

                                    </body>
                                    </html>



