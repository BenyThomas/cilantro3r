<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/main_layout}">
    <head>
        <title>Recon Dashboard</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div layout:fragment="pageStyle" th:remove="tag">
            <link th:href="@{/assets/plugins/bootstrap-tagsinput/css/bootstrap-tagsinput.css}" rel="stylesheet" />
            <link rel="stylesheet" th:href="@{/assets/plugins/switchery/switchery.min.css}">
            <link th:href="@{/assets/plugins/select2/css/select2.min.css}" rel="stylesheet" type="text/css" />
            <link th:href="@{/assets/plugins/timepicker/bootstrap-timepicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/clockpicker/css/bootstrap-clockpicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.css}" rel="stylesheet">
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div layout:fragment="contents" id="reconData">
                    <div class="panel panel-default panel-fill"  >
                        <div class="panel-heading"> <h4 class="panel-title">DAILY  RECONCILIATION DASHBOARD
                            </h4></div>
                        <div class="panel-body">
                            <form role="form" name="getReconDashboard">
                                <div class="row">
                                    <div class="form-group col-md-3">
                                        <label for="txnType">Transaction Type </label>
                                        <select class="form-control" id="txnType" name="txnType" style="width: 250px" >
                                            <option value="">Please select Txn Type ....</option>
                                            <option th:each="txn_type: ${txn_types}" th:value="${txn_type.code}" th:text="${txn_type.name}"  th:selected="${txn_type.code.equals(session.ttype)}" > ATM  </option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="txnDate" >Date</label>
                                        <input th:value="${session.txndate}"  name="txnDate" class="form-control form-control-inline input-txndatemedium default-date-picker"  id="datepicker-autoclose" data-date-format="yyyy-mm-dd" type="text" placeholder="yyyy-mm-dd" autocomplete="off"/>
                                    </div>
                                    <div class="form-group col-md-3 text-right m-b-0" style="margin: 2%;">
                                        <button  type="submit" class="btn btn-info btn-submit">Search</button>
                                    </div>
                                </div>
                            </form>
                            <div class="row" id="preloader2"> 
                                <img th:src="@{/assets/images/please_wait.gif}" alt="please wait"/>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <section class="panel" style="border: 1px solid #dee2e6">
                                        <header class="panel-heading" style="background: #1b9a20;  color: white">                                    
                                            CORE BANKING SIDE <span th:text="${session.txndate}" ></span>
                                        </header>
                                        <table class="table" border="1px" style="font-size: 10px">
                                            <thead>
                                                <tr>
                                                    <th>Description</th>
                                                    <th>Txn Type</th>
                                                    <th>Txns</th>
                                                    <th>Volume</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>  <td  th:text="${'Opening Balance'}" th:rowspan="${session.rowspan}"></td></tr>
                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}" th:colspan="${2}"></td>
                                                    <td th:text="${#numbers.formatDecimal(data.getCoreBanking.get(0).get('openingBalance'),0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                                <tr>  <td  th:text="${'Transaction Voulmes'}" th:rowspan="${session.rowspan}"></td></tr>
                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}"></td>
                                                    <td th:text="${#numbers.formatDecimal(data.getCoreBanking.get(0).get('txnCount'), 0, 'COMMA', 0, 'POINT')}"></td>
                                                    <td th:text="${#numbers.formatDecimal(data.getCoreBanking.get(0).get('txnvolume'),0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                                <tr> 
                                                    <td  th:text="${'Closing Balance'}" th:rowspan="${session.rowspan}"></td>
                                                </tr>
                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}" th:colspan="${2}"></td>
                                                    <td th:text="${#numbers.formatDecimal(data.getCoreBanking.get(0).get('closingBalance'),0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </section>
                                </div>
                                <div class="col-md-4">
                                    <section class="panel" style="border: 1px solid #dee2e6">
                                        <header class="panel-heading" style="background: #22d8e2;  color: white">
                                            THIRD PARTY SIDE <span th:text="${session.txndate}" ></span>
                                        </header>
                                        <table class="table" border="1px" style="font-size: 10px">
                                            <thead>
                                                <tr>
                                                    <th>Description</th>
                                                    <th>Txn Type</th>
                                                    <th>Txns</th>
                                                    <th>Volume</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>  <td  th:text="${'Opening Balance'}" th:rowspan="${session.rowspan}"></td></tr>

                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}" th:colspan="${2}"></td>
                                                    <td th:text="${#numbers.formatDecimal(data.getThirdParty.get(0).get('openingBalance'),0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                                <tr>  <td  th:text="${'Transaction Volumes'}" th:rowspan="${session.rowspan}"></td></tr>

                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}"></td>
                                                    <td th:text="${#numbers.formatDecimal(data.getThirdParty.get(0).get('txnCount'),0, 'COMMA', 0, 'POINT')}"></td>
                                                    <td th:text="${#numbers.formatDecimal(data.getThirdParty.get(0).get('txnvolume'),0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                                <tr>  <td  th:text="${'Closing Balance'}" th:rowspan="${session.rowspan}"></td></tr>

                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}" th:colspan="${2}"></td>
                                                    <td  th:text="${#numbers.formatDecimal(data.getThirdParty.get(0).get('closingBalance'),0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </section>
                                </div>
                                <div class="col-md-4">
                                    <section class="panel" style="border: 1px solid #dee2e6">
                                        <header class="panel-heading" style="background: #e20b0b; color: white">
                                            DIFFERENCE <span th:text="${session.txndate}" ></span>
                                        </header>
                                        <table class="table" border="1px" style="font-size: 10px">
                                            <thead>
                                                <tr>
                                                    <th>Description</th>
                                                    <th>Txn Type</th>
                                                    <th>Txns</th>
                                                    <th>Volume</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>  
                                                    <td  th:text="${'Opening Balance'}" th:rowspan="${session.rowspan}"></td></tr>
                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}" th:colspan="${2}"></td>
                                                    <td th:text="${#numbers.formatDecimal(#conversions.convert(data.getThirdParty.get(0).get('openingBalance'),'Double')+#conversions.convert(data.getCoreBanking.get(0).get('openingBalance'),'Double'), 0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                                <tr>  <td  th:text="${'Transaction Volumes'}" th:rowspan="${session.rowspan}"></td></tr>
                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}"></td>
                                                    <td  th:text="${#numbers.formatDecimal(#conversions.convert(data.getThirdParty.get(0).get('txnCount'),'Double')-#conversions.convert(data.getCoreBanking.get(0).get('txnCount'),'Double'), 0, 'COMMA', 0, 'POINT')}"></td>
                                                    <td th:text="${#numbers.formatDecimal(#conversions.convert(data.getThirdParty.get(0).get('txnVolume'),'Double')-#conversions.convert(data.getCoreBanking.get(0).get('txnVolume'),'Double'), 0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                                <tr>  <td  th:text="${'Closing Balance'}" th:rowspan="${session.rowspan}"></td></tr>
                                                <tr th:if="${session.txntypes}" th:each="data:${session.reconDashboardData}">
                                                    <td th:text="${data.txn_type}" th:colspan="${2}"></td>
                                                    <td th:text="${#numbers.formatDecimal(#conversions.convert(data.getThirdParty.get(0).get('closingBalance'),'Double')+#conversions.convert(data.getCoreBanking.get(0).get('closingBalance'),'Double'), 0, 'COMMA', 2, 'POINT')}"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </section>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="card-box">
                                            <div th:text="${reconDashboardTabs}"></div>
                                            <ul class="nav nav-tabs" >
                                                <li class="nav-item"  th:each="tabs:${session.reconDashboardTabs}">
                                                    <a style="font-size: 10px !important;" th:href="@{'#'+${tabs.url}}" th:text="${tabs.name}"  th:data-url="${tabs.url}" data-toggle="tab" data-target="#tabContent" aria-expanded="true" id="tabContentsss"class="nav-link">
                                                        tab name
                                                    </a>
                                                </li>
                                                <li ><strong th:text="${session.txnDate}"></strong></li>
                                            </ul>
                                            <div class="row" id="preloader"> 
                                                <img th:src="@{/assets/images/please_wait.gif}" alt="please wait"/>
                                            </div>
                                            <div id="tabContent">
                                            </div>

                                            <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div id="areaValue">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div> <!-- end col -->
                                </div>
                                <!-- end row -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div layout:fragment="pageScript" th:remove="tag">
            <script th:src="@{/assets/plugins/bootstrap-tagsinput/js/bootstrap-tagsinput.min.js}"></script>
            <script th:src="@{/assets/plugins/select2/js/select2.min.js}" type="text/javascript"></script>
            <script th:src="@{/assets/plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js}" type="text/javascript"></script>
            <script th:src="@{/assets/plugins/switchery/switchery.min.js}"></script>
            <script type="text/javascript" th:src="@{/assets/plugins/parsleyjs/parsley.min.js}"></script>
            <script th:src="@{/assets/plugins/moment/moment.js}"></script>
            <script th:src="@{/assets/plugins/timepicker/bootstrap-timepicker.js}"></script>
            <script th:src="@{/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js}"></script>
            <script th:src="@{/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js}"></script>
            <script th:src="@{/assets/plugins/clockpicker/js/bootstrap-clockpicker.min.js}"></script>
            <script th:src="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.js}"></script>
            <!--<script th:src="@{/assets/plugins/summernote/summernote-bs.min.js}"></script>-->
            <script>
                $(document).ready(function () {
                    $('#preloader').hide();
                    $('#preloader2').hide();
                    $('input[id$=datepicker-autoclose]').datepicker({dateFormat: 'yy-mm-dd'});
                    /*  Submit form using Ajax */
                    $('button[type=submit]').click(function (e) {
                        $('#preloader2').show();
                        //Prevent default submission of form
                        e.preventDefault();
                        //Remove all errors
                        $('input').next().remove();
                        var txnType = $("select[name='txnType']").val();
                        var txnDate = $("input[name='txnDate']").val();
                        $.ajax({
                            url: "/getReconDashboard",
                            type: 'GET',
                            data: {txnType: txnType, txnDate: txnDate},
                            dataType: "json",
                            success: function (res) {
                                $('.error').html('');
                                if (res.validated) {
                                    $('#preloader2').hide();
                                    location.reload();
                                } else {
                                    $('#preloader2').hide();
                                    $.each(res.errorMessages, function (key, value) {
                                        $('Select[name=' + key + ']').after('<span class="error" style="color:red">' + value + '</span>');
                                        $('input[name=' + key + ']').after('<span class="error" style="color:red">' + value + '</span>');
                                    });
                                }
                            }
                        })
                    });
                    //load the tab content
                    $('[data-toggle="tab"]').click(function (e) {
                        $("#preloader").show();
                        var $this = $(this),
                                loadurl = $this.attr('data-url');
                        $.ajax({
                            url: loadurl,
                            type: 'GET',
                            success: function (res) {
                                $("#tabContent").html(res).return;
                                //$("#tabContent").show();
                                $("#preloader").hide();
                            }
                        });
                        //$this.tab('show');

                        return true;
                    });
                });
            </script>
        </div>
    </body>
</html>
