<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/main_layout}">
    <head>
        <title>Third party Transactions report</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div layout:fragment="pageStyle" th:remove="tag">
            <link th:href="@{/assets/plugins/bootstrap-tagsinput/css/bootstrap-tagsinput.css}" rel="stylesheet" />
            <link rel="stylesheet" th:href="@{/assets/plugins/switchery/switchery.min.css}">
            <link th:href="@{/assets/plugins/select2/css/select2.min.css}" rel="stylesheet" type="text/css" />
            <link th:href="@{/assets/plugins/timepicker/bootstrap-timepicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/clockpicker/css/bootstrap-clockpicker.min.css}" rel="stylesheet">
            <link th:href="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.css}" rel="stylesheet">
            <link href="@{/assets/plugins/datatables/jquery.dataTables.min.css}" rel="stylesheet" type="text/css"/>
            <link href="@{/assets/plugins/datatables/buttons.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link href="@{/assets/plugins/datatables/responsive.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link href="@{/assets/plugins/datatables/scroller.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link href="@{/assets/plugins/datatables/dataTables.colVis.css}" rel="stylesheet" type="text/css"/>
            <link href="@{/assets/plugins/datatables/dataTables.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link href="@{/assets/plugins/datatables/fixedColumns.dataTables.min.css}" rel="stylesheet" type="text/css"/>
            <link href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet">
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div layout:fragment="contents" id="reconData">
                    <div class="panel panel-default panel-fill"  >
                        <div class="panel-heading"> <h4 class="panel-title" th:text="${pageTitle}"></h4></div>
                        <div class="panel-body">
                            <form role="form" name="getReconDashboard">
                                <div class="row">
                                    <div class="form-group col-md-3">
                                        <label for="exampleInputEmail1">Transaction Type </label>
                                        <select class="form-control" id="txnType" name="txnType" style="width: 250px" >
                                            <option value="">Select Txn Type ....</option>
                                            <option th:each="txn_type: ${txn_types}" th:value="${txn_type.code}" th:text="${txn_type.name}"> ATM  </option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="date" >From Date</label>
                                        <input name="fromdate" class="form-control form-control-inline input-txndatemedium default-date-picker"  id="datepicker-autoclose" data-date-format="yyyy-mm-dd" type="text" placeholder="yyyy-mm-dd" autocomplete="off"/>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="date" >To Date</label>
                                        <input name="todate" class="form-control form-control-inline input-txndatemedium default-date-picker"  id="datepicker-autoclose" data-date-format="yyyy-mm-dd" type="text" placeholder="yyyy-mm-dd" autocomplete="off"/>
                                    </div>
                                    <div class="form-group col-md-3 text-right m-b-0" style="margin-top: 2%;margin-left: -10%" >
                                        <button  type="submit" class="btn btn-info btn-submit">Search</button>
                                    </div>
                                </div>
                            </form>
                            <div class="row" id="preloader2"> 
                                <img th:src="@{/assets/images/please_wait.gif}" alt="please wait"/>
                            </div>
                            <div class="col-sm-12">
                                <table id="thirdPartyTxns" hidden="" class="table table-striped table-bordered"  style="width: 100%; font-size: 11px !important;">
                                    <thead>
                                        <tr>
                                            <th>S/N</th>
                                            <th>Transaction Date</th>
                                            <!--<th>TransactionType</th>-->
                                            <th>ReferenceNo</th>
                                            <th>CardNo</th>
                                            <th>Account_Number</th>
                                            <th>Amount</th>
                                            <th>Charge</th>
                                            <th>Status</th>
                                            <th>Description</th>
                                            <th>Post_Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div layout:fragment="pageScript" th:remove="tag">
            <script th:src="@{/assets/plugins/bootstrap-tagsinput/js/bootstrap-tagsinput.min.js}"></script>
            <script th:src="@{/assets/plugins/select2/js/select2.min.js}" type="text/javascript"></script>
            <script th:src="@{/assets/plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js}" type="text/javascript"></script>
            <script th:src="@{/assets/plugins/switchery/switchery.min.js}"></script>
            <script type="text/javascript" th:src="@{/assets/plugins/parsleyjs/parsley.min.js}"></script>
            <script th:src="@{/assets/plugins/moment/moment.js}"></script>
            <script th:src="@{/assets/plugins/timepicker/bootstrap-timepicker.js}"></script>
            <script th:src="@{/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js}"></script>
            <script th:src="@{/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js}"></script>
            <script th:src="@{/assets/plugins/clockpicker/js/bootstrap-clockpicker.min.js}"></script>
            <script th:src="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.js}"></script>
            <script th:src="@{/assets/plugins/datatables/jquery.dataTables.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.bootstrap.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.buttons.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/buttons.bootstrap.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/jszip.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/pdfmake.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/vfs_fonts.js}"></script>
            <script th:src="@{/assets/plugins/datatables/buttons.html5.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/buttons.print.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.keyTable.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.responsive.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/responsive.bootstrap.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.scroller.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.colVis.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.fixedColumns.min.js}"></script>
            <!-- init -->
            <script th:src="@{/assets/pages/jquery.datatables.init.js}"></script>
            <!-- App Js -->
            <script th:src="@{/assets/js/jquery.app.js}"></script>
            <script th:src="@{/assets/plugins/select2v4/select2.min.js}"></script>
            <!-- Key Tables -->
            <script th:src="@{/assets/plugins/datatables/dataTables.keyTable.min.js}"></script>
            <!-- Responsive examples -->
            <script th:src="@{/assets/plugins/datatables/dataTables.responsive.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/responsive.bootstrap.min.js}"></script>

            <!-- Selection table -->
            <script th:src="@{/assets/plugins/datatables/dataTables.select.min.js}"></script>
            <script th:src="@{/assets/js/moment.min.js}"></script>
            <script>
                function addCommas(nStr)
                {
                    nStr += '';
                    x = nStr.split('.');
                    x1 = x[0];
                    x2 = x.length > 1 ? '.' + x[1] : '';
                    var rgx = /(\d+)(\d{3})/;
                    while (rgx.test(x1)) {
                        x1 = x1.replace(rgx, '$1' + ',' + '$2');
                    }
                    return x1 + x2;
                }
                $(document).ready(function () {
                    $('#preloader').hide();
                    $('#preloader2').hide();
                    $('input[id$=datepicker-autoclose]').datepicker({dateFormat: 'yy-mm-dd'});
                    /*  Submit form using Ajax */
                    $('button[type=submit]').click(function (e) {
                        $('#preloader2').show();
                        //Prevent default submission of form
                        e.preventDefault();
                        //Remove all errors
                        $('input').next().remove();
                        var txnType = $("select[name='txnType']").val();
                        var fromdate = $("input[name='fromdate']").val();
                        var todate = $("input[name='todate']").val();
                        $.ajax({
                            url: "/getThirdPartTxnsReportAjax",
                            type: 'GET',
                            data: {txnType: txnType, fromdate: fromdate, todate: todate},
                            dataType: "json",
                            success: function (res) {
                                var i = 0;
                                $('.error').html('');
                                if (res.validated) {
                                    $('#preloader2').hide();
                                    $('#thirdPartyTxns').show();
                                    $('#thirdPartyTxns').DataTable({
                                        "info": true,
                                        "bDestroy": true,
                                        "dom": "Bfrtip",
                                        "data": JSON.parse(res.jsonString),
                                        lengthChange: true,
                                        "columns": [
                                            {"data": 'txnid',
                                                "render": function (data) {
                                                    i = i + 1;
                                                    return i;
                                                    ;
                                                }},
                                            {"data": 'txndate'},
//                                            {"data": "txn_type"},
                                            {"data": "txnid"},
                                            {"data": "pan"},
                                            {"data": "destinationaccount"},
                                            {"data": 'amount',
                                                "render": function (data) {
                                                    var amount = addCommas(data);
                                                    return amount;
                                                }},

                                            {"data": "charge"},
                                            {"data": "mnoTxns_status"},
                                            {"data": "description"},
                                            {"data": 'post_balance',
                                                "render": function (data) {
                                                   
                                                    return addCommas(data);
                                                }},
                                        ], buttons: [{
                                                extend: "copy",
                                                title: 'Third Party Transactions',
                                                className: "btn-sm"
                                            }, {
                                                extend: "csv",
                                                title: 'Third Party Transactions',
                                                className: "btn-sm"
                                            }, {
                                                extend: "excel",
                                                title: 'Third Party Transactions',
                                                className: "btn-sm"
                                            }, {
                                                extend: "pdf",
                                                title: 'Third Party Transactions',
                                                className: "btn-sm"
                                            }, {
                                                extend: "print",
                                                title: 'Third Party Transactions',
                                                className: "btn-sm"
                                            }],
                                        responsive: !1,
                                    });
                                } else {
                                    $('#preloader2').hide();
                                    $.each(res.errorMessages, function (key, value) {
                                        $('Select[name=' + key + ']').after('<span class="error" style="color:red">' + value + '</span>');
                                        $('input[name=' + key + ']').after('<span class="error" style="color:red">' + value + '</span>');
                                    });
                                }
                            }
                        });
                    });
                    //load the tab content
                    $('[data-toggle="tab"]').click(function (e) {
                        $("#preloader").show();
                        var $this = $(this),
                                loadurl = $this.attr('data-url');
                        $.ajax({
                            url: loadurl,
                            type: 'GET',
                            success: function (res) {
                                $("#tabContent").html(res);
                                $("#tabContent").show();
                                $("#preloader").hide();
                            }
                        });
                        $this.tab('show');

                        return true;
                    });
                });
            </script>
        </div>
    </body>
</html>
