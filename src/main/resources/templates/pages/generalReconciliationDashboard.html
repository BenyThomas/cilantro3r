<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html layout:decorate="~{fragments/main_layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>Recon Dashboard</title>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
</head>
<body>
<div layout:fragment="pageStyle" th:remove="tag">
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-tagsinput/css/bootstrap-tagsinput.css}"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/switchery/switchery.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/select2/css/select2.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/timepicker/bootstrap-timepicker.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/clockpicker/css/bootstrap-clockpicker.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.css}">
    <!--    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">-->
</div>
<div class="container container-fluid">
    <div class="row">
        <div id="reconData" layout:fragment="contents">
            <div class="panel panel-default panel-fill">
                <div class="panel-heading">
                    <h4 class="panel-title"><h4 class="panel-title" th:text="${pageTitle}"></h4>
                </div>
                <div class="panel-body">
                    <form id="getGeneralReconDashboardForm">
                        <div class="row">
                            <div class="form-group col-md-4">
                                <label style="margin-left:1px; importrant;">Transaction Type</label>
                                <select class="form-control select2" id="txnType" name="txnType" style="width: 250px">
                                    <option th:each="config:${reconConfigs}" th:text="${config.txnType}"
                                            th:value="${config.txnType}"
                                            th:selected="${config.txnType.equals(session.txnType)}"></option>
                                </select>
                            </div>

                            <div class="form-group col-md-4">
                                <label for="reconDate" style="margin-left:1px; importrant;">Date</label>
                                <input autocomplete="off" class="form-control form-control-inline input-txndatemedium default-date-picker dpicker"
                                       data-date-format="yyyy-mm-dd"
                                       id="reconDate" name="reconDate" placeholder="yyyy-mm-dd" th:value="${session.txndate}"
                                       type="text"/>
                            </div>
                            <div class="form-group col-md-4" style="margin-top:1%;">
                                <button class="btn btn-info btn-submit" data-reportFormat="preview" id="generalReconBtn"
                                        style="margin-top:10px;" type="button">Search
                                </button>
                            </div>
                        </div>
                    </form>
                    <div id="preview" th:utext="${session.jasperDisplay}"></div>
                    <div class="row">
                        <form action="/fireDownlodGeneralReport" id="downloadReconReport" method="get" role="form">
                            <input id="hiddenTtype" name="ttype" type="hidden" th:value="${session.txnType}">
                            <input id="hiddenTxnType" name="txnType" type="hidden" value="${session.txnType}">
                            <input id="hiddenReconDate" name="hiddenReconDate" type="hidden" value="${session.reconDate}">
                            <input id="hiddenReportFormat" name="reportFormat" type="hidden" value="excel">
                                <button th:if="${session.showDownload}" th:text="${'Download Report'}" class="btn btn-success" id="downloadGeneralReport" style="margin-top:2%; margin-bottom:2%;"
                                    type="submit">
                            </div>
                        </form>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="card-box">
                                <ul class="nav nav-tabs">
                                    <li class="nav-item" th:each="tabs:${session.generalReconTabs}">
                                        <a aria-expanded="true" class="nav-link"
                                           data-target="#tabContent" data-toggle="tab" id="tabContentsss"
                                           th:data-exceptionType="${tabs.exception_type}"
                                           style="font-size: 10px !important;" th:data-url="${tabs.url}" th:href="@{'#'+${tabs.url}}"
                                           th:text="${tabs.name}">
                                            tab name
                                        </a>
                                    </li>
                                    <li><strong th:text="${session.txnDate}"></strong></li>
                                </ul>
                                <div class="row" id="preloader">
                                    <img alt="please wait" th:src="@{/assets/images/please_wait.gif}"/>
                                </div>
                                <div id="tabContent">
                                </div>

                                <div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade" id="myModal"
                                     role="dialog" tabindex="-1">
                                    <div class="modal-dialog">
                                        <div id="areaValue">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- end col -->
                    </div>


                    <div class="row" id="preloader2">
                        <img alt="please wait" th:src="@{/assets/images/please_wait.gif}"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div layout:fragment="pageScript" th:remove="tag">
    <script th:src="@{/assets/plugins/bootstrap-tagsinput/js/bootstrap-tagsinput.min.js}"></script>
    <script th:src="@{/assets/plugins/select2/js/select2.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js}"
            type="text/javascript"></script>
    <script th:src="@{/assets/plugins/switchery/switchery.min.js}"></script>
    <script th:src="@{/assets/plugins/parsleyjs/parsley.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/plugins/moment/moment.js}"></script>
    <script th:src="@{/assets/plugins/timepicker/bootstrap-timepicker.js}"></script>
    <script th:src="@{/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js}"></script>
    <script th:src="@{/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js}"></script>
    <script th:src="@{/assets/plugins/clockpicker/js/bootstrap-clockpicker.min.js}"></script>
    <script>
                $(document).ready(function () {
                    $('#preloader').hide();
                    $('#preloader2').hide();
                    $('#reconDate').datepicker({dateFormat: 'yy-mm-dd',
                        maxDate: -1
                    });

                    $(".select2").select2({
                        width:"100%"
                    });

                    $('#generalReconBtn').click(function () {
                        var reportFormat = $(this).attr('data-reportFormat');
                        var choosenDate = $('#reconDate').val();
                        if (choosenDate != "") {
                            var token = $("meta[name='_csrf']").attr("content");
                            var header = $("meta[name='_csrf_header']").attr("content");
                            var formdata = new FormData($('#getGeneralReconDashboardForm')[0]);
                            formdata.append('reportFormat',reportFormat);
                            $.ajax({
                                processData: false,
                                contentType: false,
                                data: formdata,
                                type: "POST",
                                url: "/cummulativeReconciliationReport",
                                beforeSend: function (request) {
                                    request.setRequestHeader(header, token);
                                    $('#loading').show();
                                },
                                success: function (response) {
                                            window.location.reload();
                                }
                            });

                        } else {
                            alert("Select Date");
                        }
                    });

                    //load the tab content
                    $('[data-toggle="tab"]').click(function (e) {
                        $("#preloader").show();
                        loadurl = $(this).attr('data-url');
                       var  exceptionType = $(this).attr('data-exceptionType');
                        var  reconDate = $('#reconDate').val();
                        $.ajax({
                            type: 'POST',
                            url: loadurl,
                            data: {exceptionType: exceptionType, reconDate: reconDate},
                            success: function (res) {
                                $("#tabContent").html(res).return;
                                //$("#tabContent").show();
                                $("#preloader").hide();
                                $('#preloader2').hide();
                            }
                        });
                        //$this.tab('show');

                        return true;
                    });
                });



    </script>
</div>
</body>
</html>
