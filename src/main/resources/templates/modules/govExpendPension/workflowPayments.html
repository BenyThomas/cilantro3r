<div layout:fragment="pageStyle" th:remove="tag">
    <style>
        #loading {
            background: url('/assets/images/ajax-loader.gif') no-repeat center center;
            position: absolute;
            top: 0;
            left: 0;
            height: 92%;
            width: 100%;
            z-index: 9999999;
        }
        .btn{
            border-radius: 0px !important;
        }
        .btn:hover {
            color: #ffffff !important;
            text-decoration: none;
        }
    </style>
    <link th:href="@{/assets/plugins/datatables/jquery.dataTables.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/plugins/datatables/buttons.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/plugins/datatables/responsive.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/plugins/datatables/scroller.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/plugins/datatables/dataTables.colVis.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/plugins/datatables/dataTables.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/plugins/datatables/fixedColumns.dataTables.min.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet">
</div>
<div class="row">
    <div class="panel panel-default panel-fill">
        <div class="panel-heading">
            <h4 class="panel-title" th:text="${pageTitle}"></h4>
        </div>
        <div class="panel-body">
            <div id="successFlag"></div>
            <div  id="loading" hidden=""></div>
            <form role="form" name="paymentReportForm" id="paymentReportForm">
                <div class="row">
                    <div class="form-group col-md-2">
                        <select class="form-control select2" id="paymentType" name="paymentType" onchange="getPaymentComponents(this)">
                            <option value="">Select Payment Type...</option>
                            <option value="MUSE"> MUSE/ERMS </option>
                            <option value="PENSION"> PENSION </option>
                        </select>
                    </div>
                    <div class="form-group col-md-2 muse-div">
                        <select class="form-control select2" id="institution" name="institution" onchange="getPaymentBatches(this)">
                            <option value="" disabled="" selected="">Select Institution...</option>
                        </select>
                    </div>
                    <div class="form-group col-md-2 muse-div">
                        <select class="form-control select2" id="batch" name="batch">
                            <option value="" disabled="" selected="">Select Batch...</option>
                        </select>
                    </div>
                    <div class="form-group col-md-2 pension-div">
                        <select class="form-control select2" id="report-type" name="report-type" onchange="getPensionersReport(this)">
                            <option value="BATCH_RECEIVED_FROM_PSSSF" disabled="" selected="">BATCH RECEIVED FROM PSSSF</option>
                            <option value="SUCCESSFUL_POSTED_BATCH">SUCCESSFUL POSTED BATCH</option>
                            <option value="UNSUCCESSFUL_POSTED_BATCH">UNSUCCESSFUL POSTED BATCH</option>
                        </select>
                    </div>
<!--                    <div class="form-group col-md-2">-->
<!--                        <input id="fromDate" name="fromDate" class="form-control form-control-inline default-date-picker"-->
<!--                               data-date-format="yyyy-mm-dd" type="text" placeholder="From: yyyy-mm-dd" autocomplete="off"/>-->
<!--                    </div>-->
<!--                    <div class="form-group col-md-2">-->
<!--                        <input id="toDate" name="toDate" class="form-control form-control-inline default-date-picker"-->
<!--                               data-date-format="yyyy-mm-dd" type="text" placeholder="To: yyyy-mm-dd" autocomplete="off"/>-->
<!--                    </div>-->
                    <div class="form-group col-md-2">
                        <button type="button" onclick="getPaymentReport()" class="btn btn-success btn-submit">Search</button>
                    </div>
                </div>
            </form>
            <hr/>
            <div class="col-sm-12" id="paymentReport"></div>
        </div>
    </div>
</div>
<div layout:fragment="pageScript" th:remove="tag">
    <script th:src="@{/assets/plugins/datatables/jquery.dataTables.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.bootstrap.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.buttons.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.bootstrap.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/jszip.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/pdfmake.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/vfs_fonts.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.html5.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.print.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.keyTable.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.responsive.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/responsive.bootstrap.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.scroller.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.colVis.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.fixedColumns.min.js}"></script>
    <!-- init -->
    <script th:src="@{/assets/pages/jquery.datatables.init.js}"></script>
    <!-- App Js -->
    <script th:src="@{/assets/js/jquery.app.js}"></script>
    <script th:src="@{/assets/plugins/select2v4/select2.min.js}"></script>
    <script th:src="@{/assets/js/sockjs.min.js}"></script>
    <script th:src="@{/assets/plugins/stomp-websocket/stomp.js}"></script>
    <script th:src="@{/assets/scripts/workflow.js}"></script>
    <script>
        $(document).ready(function () {
            $("#fromDate, #toDate").datepicker({
                autoclose: true,
                todayHighlight: true
            });
            $("#loading").hide();
            $(".select2").select2();
        });

        function getPaymentComponents(control) {
            console.log(control.value);
            $("#loading").show();
            $.ajax({
                url: "/getInstitutionsAccounts",
                type: 'POST',
                data: {paymentType: $('#paymentType').val},
                dataType: "json",
                success: function (res) {
                    $("#loading").hide();
                    $.each(res, function (i, item) {
                        $('#institution').append($('<option>', {
                            value: item.accountNo,
                            text: item.accountName
                        }));
                    });
                },
                error: function (res) {
                    $("#loading").hide();
                    $("#successFlag").html('<div class="alert alert-danger" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close">x</button><strong>' + res.message + res.result + '</strong></div>').show();
                    console.log(res);
                }
            })
        }

        function getPaymentBatches(institution) {
            $("#loading").show();
            $.ajax({
                url: "/queryBatchesBasedOnInstitution",
                type: 'POST',
                data: {paymentType: 'MUSE', account: institution.value},
                dataType: "json",
                success: function (res) {
                    $("#loading").hide();
                    $.each(res, function (i, item) {
                        $('#batch').append($('<option>', {
                            value: item,
                            text: item
                        }));
                    });
                },
                error: function (res) {
                    $("#loading").hide();
                    $("#successFlag").html('<div class="alert alert-danger" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close">x</button><strong>Seems there is an issue with network connection!</strong></div>').show();
                    console.log(res);
                }
            })
        }

        function getPaymentReport() {
            var formData = new FormData($('#paymentReportForm')[0]);
            $.ajax({
                url: "/getPaymentReportsAjax",
                type: 'POST',
                data: formData,
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (res) {
                    $("#loading").hide();
                    $('#paymentReport').html(res);
                },
                error: function (res) {
                    $("#loading").hide();
                    $("#successFlag").html('<div class="alert alert-danger" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close">x</button><strong>' + res.message + res.result + '</strong></div>').show();
                    console.log(res);
                }
            })
        }
    </script>
</div>
