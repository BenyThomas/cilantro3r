<div layout:fragment="pageStyle" th:remove="tag">
    <style>
      #loading {
          background: url('/assets/images/ajax-loader.gif') no-repeat center center;
          position: absolute;
          top: 0;
          left: 0;
          height: 92%;
          width: 100%;
          z-index: 9999999;
      }

    .form-group {
      position: relative;
    }
    .input-field {
      font-weight: 80;
      font-size: 1.2rem;
      padding: 15px 15px;
      border: 2px solid  #D9D9D9;
      outline:none;
    }
    .placeholder {
      position: absolute;
      margin: 17px 2px;
      padding: 2 4px;
      display: flex;
      align-items: center;
      top: 0;
      left: 17px;
      transition: all 0.2s;
      transform-origin: 0% 0%;
      background: none;
      pointer-events: none;
    }
    .input-field:valid + label.placeholder,
    .input-field:focus + label.placeholder {
      transform: scale(0.8) translateY(-30px);
      background: #fff;
    }
    .input-field:focus{
      color: #284B63;
      border-color: #284B63;
    }
    .input-field:focus + label.placeholder {
      color: #284B63;
    }
    </style>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/jquery.dataTables.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/buttons.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/responsive.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/scroller.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/dataTables.colVis.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/dataTables.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/fixedColumns.dataTables.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/select2/css/select2.min.css}" type="text/css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
    <!-- iziToast -->
    <link th:href="@{/assets/plugins/iziman/dist/css/iziToast.min.css}" rel="stylesheet" type="text/css"/>
</div>

<div class="row">
    <div class="col-sm-12">
        <div id="reconData" layout:fragment="contents">
            <div class="panel panel-default panel-fill">
                <div class="panel-heading"><h4 class="panel-title" th:text="${pageTitle}"></h4></div>
                <div class="panel-body">
                    <div class="row" id="preloader2">
                        <img alt="please wait" th:src="@{/assets/images/please_wait.gif}"/>
                    </div>
                    <!--- success start--->
                    <div class="col-md-12" id="successFlag"></div>
                    <!------ End ------->
                    <br>
                    <!--- FORM START ----->
                    <div class="row" id="another-element">
                            <form id="form4">
                                <div class="form-group col-md-5">
                                    <input type="text" name="agent_code" id="agent_code" class="form-control input-field" required spellcheck="false">
                                    <label for="agent_code" class="placeholder">Agent Code</label>
                                </div>
                                <div class="form-group col-md-5">
                                    <input type="text" name="agent_reference" id="agent_reference" class="form-control input-field" required spellcheck="false">
                                    <label for="agent_reference" class="placeholder">Agent Reference</label>
                                </div>

                                <div class="row">
                                    <div class="form-group col-md-2">
                                        <div class="form-group col-md-3 text-right m-b-0" style="margin: 7%;">
                                            <button class="btn btn-primary" onclick="validateAgent()"  type="button" style="font-size:11px;">Validate Agent</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="row" style="display:none;" id="agentAcctValidate">
                                    <div class="form-group col-md-5">
                                        <input type="text" name="agent_account" id="agent_account" class="form-control input-field" required spellcheck="false">
                                        <label for="agent_account" class="placeholder">Agent Account</label>

                                        <div class="form-group col-md-3" style="margin-top:10% | important;">
                                            <a class="btn btn-primary btn-submit pull-left" onclick="getCustomerDetails()" style="margin: 10%;font-size: 10px !important;" type="button">Query Details</a>
                                        </div>
                                    </div>
                                </div>
                            </form>
                    </div>
                    <!--- FORM END ---->
                    <div class="row" id="dataTable" style="display:none;background-color:#DFF5FF;">
                        <table class="table table-bordered">
                            <tbody>
                            <tr>
                                <th>Agent Account</th>
                                <td id="agentAccount"></td>
                            </tr>
                            <tr>
                                <th>Account Name</th>
                                <td id="actNM"></td>
                            </tr>
                            <tr>
                                <th>Customer Rubikon Name</th>
                                <td id="customerName"></td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td id="status"></td>
                            </tr>

                            <tr>
                                <th>Agent Code</th>
                                <td id="agentCode"></td>
                            </tr>
                            <tr>
                                <th>Agent Name</th>
                                <td id="agentName"></td>
                            </tr>
                            <tr>
                                <th>Agent Reference</th>
                                <td id="agentReference"></td>
                            </tr>

                            <tr>
                                <th>Description</th>
                                <td id="description"></td>
                            </tr>
                            <tr>
                                <th>Request Time</th>
                                <td id="requestTime"></td>
                            </tr>
                            <tr>
                                <th>Transaction Id</th>
                                <td id="transactionId"></td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="row">
                            <div class="form-group col-md-3" style="margin-top:7% | important;">
                                <button class="btn btn-primary btn-submit pull-left" id="mapAgentAcctBtn" onclick="mapAgentDetails()" style="margin: 10%;font-size: 13px !important;" type="button" disabled>Map Agent Details</button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<div layout:fragment="pageScript" th:remove="tag">
    <script th:src="@{/assets/plugins/datatables/jquery.dataTables.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.bootstrap.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.buttons.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.bootstrap.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/jszip.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/pdfmake.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/vfs_fonts.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.html5.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.print.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.keyTable.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.responsive.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/responsive.bootstrap.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.scroller.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.colVis.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.fixedColumns.min.js}"></script>
    <script th:src="@{/assets/plugins/timepicker/bootstrap-timepicker.js}"></script>
    <script th:src="@{/assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js}"></script>
    <script th:src="@{/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js}"></script>
    <script th:src="@{/assets/plugins/clockpicker/js/bootstrap-clockpicker.min.js}"></script>
    <script th:src="@{/assets/plugins/bootstrap-daterangepicker/daterangepicker.js}"></script>
    <!-- init -->
    <script th:src="@{/assets/pages/jquery.datatables.init.js}"></script>
    <!-- App Js -->
    <script th:src="@{/assets/js/jquery.app.js}"></script>
    <script th:src="@{/assets/plugins/select2v4/select2.min.js}"></script>
    <!-- iziToast -->
    <script th:src="@{/assets/plugins/iziman/dist/js/iziToast.min.js}" type="text/javascript"></script>
    <script>
        $(document).ready(function () {
            $("#preloader2").hide();
        }); //END DOCUMENT READY


            function validateAgent(){
               var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                var formData = new FormData($('#form4')[0]);
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                var count = 0;
<!--               $("#preloader2").show();-->
                 iziToast.success({ title: 'PROCESSING', message: 'System Validating Agent Details', color:'green',position:'topRight', timeout: 3000 });

               //ajax start
                $.ajax({
                    processData: false,
                    contentType: false,
                    data: formData,
                    type: "POST",
                    'url': '/fireValidateAgentDetails',
                    beforeSend: function (request) {
                        request.setRequestHeader(header, token);
                    },

                    success: function (response) {
                                            $("#preloader2").hide();
                    var json = JSON.parse(response);
                            if(json.statusCode === '21000'){
                                    $("#agentAcctValidate").show();
                                    $("#dataTable").show();
                                    $('#status').html(json.data.active);
                                    $('#agentCode').html(json.data.agentCode);
                                    $('#agentName').html(json.data.agentName);
                                    $('#agentReference').html(json.data.agentReference);
                                    $('#description').html(json.data.description);
                                    $('#requestTime').html(json.data.requestTime);
                                    $('#transactionId').html(json.data.transactionId);
                            }else{
                               iziToast.error({ title: 'ERROR', message: json.description, color:'red',position:'topRight', timeout: 3000 });
                               $("#agentAcctValidate").hide();
                               $("#dataTable").hide();
                            }
                    },
                    error: function (e) {
                        $("#preloader2").hide();
                        console.log(e);
                    }
                }); //end ajax

            } //end  function


            function getCustomerDetails() {
                 iziToast.success({ title: 'PROCESSING', message: 'System Validating Agent Account From CBS', color:'green',position:'topRight', timeout: 3000 });
            var accountNo = $("input[name='agent_account']").val();
            $.ajax({
                url: "/queryCustomerDetails",
                type: 'GET',
                data: {accountNo: accountNo, code: "searchAccount"},
                dataType: "json",
                success: function (res) {
                    $("#mapAgentAcctBtn").prop('disabled',false);
                    $("#agentAccount").html(accountNo);
                    $("#actNM").html(res[0].CUST_NM);
                    $("#customerName").html(res[0].CUST_NM);
                    console.log(res[0])
                },
                error: function (res) {
                    $("#loading").hide();
                    $('#senderAccount').after('<h4 class="error" style="color:red     font-size: 8px !important;"> Error: Please Try Again. Please contact IT Helpdesk / Database Administrator: RUBIKON NOT FOUND</h4>');
                    console.log(res);
                }
            })
        }

        function mapAgentDetails(){
                    var agentAccount = $("#agentAccount").text();
                    var agentAccountName = $("#actNM").text();
                    var status = $("#status").text();
                    var agentCode = $("#agentCode").text();
                    var agentName = $("#agentName").text();
                    var agentReference = $("#agentReference").text();
                    var description = $("#description").text();
                    var requestTime = $("#requestTime").text();
                    var transactionId = $("#transactionId").text();
                          console.log("going to map agent details... {}",agentAccount,agentAccountName,status,agentCode,agentName,agentReference,description,requestTime,transactionId);
               //ajax start
                $.ajax({
                    data: {agentAccount: agentAccount, agentAccountName: agentAccountName, status:status, agentCode:agentCode, agentName:agentName, agentReference:agentReference, description:description, requestTime:requestTime, transactionId:transactionId},
                    type: "POST",
                    'url': '/fireMapAgentDetails',
                    success: function (response) {
                          if(response.result === '200'){
                              iziToast.success({ title: 'PROCESSING', message: 'Agent Mapped Successfully', color:'green',position:'topRight', timeout: 3000 });
                          }else if(response.result === '26'){
                             iziToast.error({ title: 'ERROR', message: 'Agent Is Already Mapped', color:'red',position:'topRight', timeout: 3000 });
                          }else{
                             iziToast.error({ title: 'ERROR', message: 'Fail to mapp agent', color:'red',position:'topRight', timeout: 3000 });
                          }
                    },
                    error: function (e) {
                        $("#preloader2").hide();
                        console.log(e);
                    }
                }); //end ajax
        }
  </script>
</div>
</body>
</html>

