<div layout:fragment="pageStyle" th:remove="tag">
    <style>
        #loading {
            background: url('/assets/images/ajax-loader.gif') no-repeat center center;
            position: absolute;
            top: 0;
            left: 0;
            height: 92%;
            width: 100%;
            z-index: 9999999;
        }
    </style>
</div>
<div class="panel panel-default panel-fill">
    <div class="panel-heading" style="background-color: #04ab18 ! important; "> <h3 class="panel-title" style="color: #ffffff !important;" th:text="${pageTitle}"></h3>
    </div>
    <div class="panel-body">
        <div class="row">
            <div id="successFlag"></div>
        </div>
        <div class="row" id="preloader2" hidden=""> 
            <img th:src="@{/assets/images/please_wait.gif}" alt="please wait"/>
        </div>
        <div class="row" id="messageData">
            <div class="col-md-4"><textarea th:text="${swiftMessage}" readonly="" rows="23" cols="50"></textarea></div>
            <div class="col-md-8">
                <form class="form-horizontal" role="form" id="specialRates">
                    <input hidden="" th:value="${reference}" name="reference">
                    <table  class="table table-striped table-bordered"  style="width: 100%; font-size: 8.5px !important;">
                        <tbody>
                            <tr>
                                <td>Currency Conversion</td>
                                <td> <input type="text" name="conversionCurrency" th:value="${conversionCurrency}" readonly="" class="form-control form-control-sm" autocomplete="off" style="font-size: 10px !important;" placeholder="Reference" ></td>
                                <td>Rubikon Rate</td>
                                <td><input type="text" name="systemRate" th:value="${rubikonRate}" readonly="" autocomplete="off"  class="form-control form-control-sm" placeholder=""></td>
                            </tr>
                            <tr>
                                <td>Requested Rate</td>
                                <td> <input type="text" name="requestedRate"  th:value="${requestedRate}" readonly="" class="form-control form-control-sm" autocomplete="off" style="font-size: 10px !important;" placeholder="Reference" ></td>
                                <td>Negotiated Rate (*Special rate from TR)</td>
                                <td> <input type="text" name="approvedRate" id="approvedRate" th:value="${requestedRate}" readonly="" required="" class="form-control form-control-sm" autocomplete="off" style="font-size: 10px !important;" placeholder="" ></td>
                            </tr>
                            <tr>
                                <td>Fx Type</td>
                                <td> <input type="text" name="requestedRate"  th:value="${fxType}" readonly="" class="form-control form-control-sm" autocomplete="off" style="font-size: 10px !important;" ></td>
                                <td>Remarks</td>
                                <td ><textarea type="text" name="remarks" id="remarks" required=""  autocomplete="off"  class="form-control form-control-sm" placeholder="Special Rates comments"></textarea></td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-primary special-rate">Accept Rate</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div layout:fragment="pageScript" th:remove="tag">
    <script th:src="@{/assets/scripts/teller.js}"></script>
</div>
<div class="row" id="preloader333" hidden=""> 
    <img th:src="@{/assets/images/please_wait.gif}" alt="please wait"/>
</div>
<!--</div>-->
<script>
    $(document).ready(function () {
        $('.special-rate').click(function (e) {
//            $('.special-rate').attr('disabled', 'disabled');
            $("#loading").show();
            var approvedRate = $("input[name='approvedRate']").val();
            var remarks = $("textarea[name='remarks']").val();
            var reference = $("input[name='reference']").val();

            if (approvedRate.length != 0) {
                $.ajax({
                    url: "/approveSpecialRate",
                    type: 'POST',
                    data: {approvedRate: approvedRate, remarks: remarks, reference: reference},
                    dataType: "json",
                    success: function (res) {
                        $("#loading").hide();
                        $('.error').html('');
                        if (res.result == 0) {
                            $("#successFlag").html('<div class="alert alert-success" role="alert" id="successFlag"><button type="button" class="close" data-dismiss="alert"asuccessFlagria-label="Close"> </button><strong>' + res.message + '</strong></div>');
                        } else {
                            $("#successFlag").html('<div class="alert alert-danger" role="alert" id="successFlag"><button type="button" class="close" data-dismiss="alert"asuccessFlagria-label="Close"> </button><strong>' + res.message + '</strong></div>');

                        }
                    }
                });
            } else {
                $("#loading").hide();
                $("#successFlag").after('<div class="alert alert-danger" role="alert" id="successFlag"><button type="button" class="close" data-dismiss="alert"asuccessFlagria-label="Close"> </button><strong>Negotiated Rate cant be left empty</strong></div>');
            }
        });
    });
</script>