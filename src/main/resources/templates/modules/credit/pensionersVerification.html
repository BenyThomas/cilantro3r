<div layout:fragment="pageStyle" th:remove="tag">
    <style>
            #loading {
                background: url('/assets/images/ajax-loader.gif') no-repeat center center;
                position: absolute;
                top: 0;
                left: 0;
                height: 92%;
                width: 100%;
                z-index: 9999999;
            };
            #rtgsTxnOnWorkFlow{
                table-layout: fixed !important;
                word-wrap:break-word;
            }


    </style>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/jquery.dataTables.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/buttons.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/responsive.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/scroller.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/dataTables.colVis.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/dataTables.bootstrap.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/fixedColumns.dataTables.min.css}" type="text/css"/>
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/timepicker/bootstrap-timepicker.min.css}">
    <link rel="stylesheet" th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}">
    <!-- iziToast -->
    <link rel="stylesheet" th:href="@{/assets/plugins/iziman/dist/css/iziToast.min.css}" type="text/css"/>
</div>
<div class="row" layout:fragment="contents">
    <div class="panel panel-default panel-fill" id="tabContentsss">
        <div class="panel-heading">
            <h4 class="panel-title" id="header" th:text="${pageTitle}"></h4>
        </div>
        <div class="panel-body">
            <div class="row" id="preloader2">
                <img alt="please wait" th:src="@{/assets/images/please_wait.gif}"/>
            </div>
            <div class="row">
                <form id="form101" role="form">
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label for="chequeNo" style="margin-left: 1% ! important;">Check Number<i
                                    class="text-danger">*</i></label>
                            <input class="form-control" id="chequeNo" name="chequeNo" placeholder="Enter Cheque number"
                                   type="text"/>
                        </div>

                        <div class="form-group col-md-4">
                            <label style="margin-left: 1% ! important;">Pension ID ( Optional )<i
                                    class="text-danger">?</i></label>
                            <div class="input-group">
                                <input class="form-control" id="pensionID" name="pensionID"
                                       placeholder="Enter Pension ID ( Optional )" type="text"/>
                                <span class="input-group-addon"><i class="mdi mdi-timer"></i></span>
                            </div><!-- input-group -->
                        </div>
                        <div class="form-group col-md-3">
                            <div class="form-group col-md-3 text-right m-b-0" style="margin-top: 25px;">
                                <button class="btn btn-info btn-submit-inwardEft-Summary" onclick="doAjaxSearching()"
                                        type="button">Search
                                </button>
                            </div>
                        </div>

                    </div>
                </form>

            </div>
            <div id="successFlag">
            </div>
            <div hidden="" id="loading"></div>
            <div class="row">
                <table class="display nowrap table table-striped table-bordered" id="dtableVerification"
                       style="width: 100%; font-size: 9.5px !important; ">
                    <thead>
                    <tr>
                        <th>SN</th>
                        <th>Pension ID</th>
                        <th>Cheque Number</th>
                        <th>Full Name</th>
                        <th>Date of Birth</th>
                        <th>Retirement Date</th>
                        <th>Monthly Payment Amount</th>
                        <th>Bank Account</th>
                        <th>Bank Name</th>
                        <th>Pensioners Type</th>
                        <th>Pensioners Status</th>
                        <th>Status Reason</th>
                        <th>Pensioner End Date</th>
                        <th>Last Payment</th>
                        <th>Has Loan</th>
                        <th>Phone</th>
                        <th>Pension Mode</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <!--</form>-->
            </div>
        </div>
    </div>
</div>
<div layout:fragment="pageScript" th:remove="tag">
    <script th:src="@{/assets/plugins/datatables/jquery.dataTables.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.bootstrap.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.buttons.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.bootstrap.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/jszip.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/pdfmake.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/vfs_fonts.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.html5.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.print.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.keyTable.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.responsive.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/responsive.bootstrap.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.scroller.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.colVis.js}"></script>
    <script th:src="@{/assets/plugins/datatables/dataTables.fixedColumns.min.js}"></script>
    <!-- init -->
    <script th:src="@{/assets/pages/jquery.datatables.init.js}"></script>
    <script th:src="@{/assets/plugins/moment/moment.js}"></script>
    <script th:src="@{/assets/plugins/timepicker/bootstrap-timepicker.js}"></script>
    <script th:src="@{/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js}"></script>

    <!-- iziToast -->
    <script th:src="@{/assets/plugins/iziman/dist/js/iziToast.min.js}" type="text/javascript"></script>

    <!-- App Js -->
    <script th:src="@{/assets/scripts/loanCredit.js}"></script>
    <script th:src="@{/assets/js/jquery.app.js}"></script>
    <script th:src="@{/assets/plugins/select2v4/select2.min.js}"></script>
    <script>
            $(document).ready(function () {
                $('#preloader2').hide();
                   $(".select22").select2();
                jQuery('#fromTime').timepicker({
                    showMeridian: false
                });
                jQuery('#toTime').timepicker({
                    showMeridian: false
                });
                jQuery('#datepicker-autoclose').datepicker({
                    autoclose: true,
                    todayHighlight: true
                });
                jQuery('#datepicker-autoclose2').datepicker({
                    autoclose: true,
                    todayHighlight: true
                });
                $('#dtableVerification').hide();
            });


      function doAjaxSearching() {
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                var formdata = new FormData($('#form101')[0]);
                var count = 0;
                iziToast.success({ title: 'PROCESSING,', message: 'System Is Fetching Data. ', color:'green',position:'topRight', timeout: 4500 });
                $.ajax({
                    processData: false,
                    contentType: false,
                    data: formdata,
                    type: "POST",
                    'url': '/firePensionerVerificationAjax',
                    beforeSend: function (request) {
                        request.setRequestHeader(header, token);
<!--                        $("#preloader2").show();-->
                    },

                    success: function (response) {
                            console.log(response);
                            if(response.status == 200){
                               $('#dtableVerification').show();
                            var table = $('#dtableVerification').DataTable({
                                dom: 'Blfrtip',
                                "info": true,
                                "bDestroy": true,
                                lengthMenu: [10, 25, 50, 100, 200, 300, 500, 1000],
                                lengthChange: true,
                                scrollCollapse: true,
                                scrollY: "700px",
                                scrollX: true,
                                buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
                                "data": response.result,
                               columns: [
                               {data:'ID',
                                  "render": function(data){
                                  count +=1;
                                  return count;
                                  }
                                  },
                                {"data": "PENSIONER_ID"},
                                {"data": "SSN"},
                                {"data": "FULLNAME"},
                                {"data": "DOB"},
                                {"data": "RETIREMENT_DATE"},
                                {"data": "MP_AMOUNT",
                                 "render": function numberWithCommas(MP_AMOUNT) {
                                    return MP_AMOUNT.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                }
                                },
                                {"data": "BANK_ACCOUNT"},
                                {"data": "BANK_NAME"},
                                {"data": "PENSIONER_TYPE"},
                                {"data": "PENSIONER_STATUS"},
                                {"data": "STATUS_REASON"},
                                {"data": "PENSIONER_END_DATE"},
                                {"data": "LAST_PAYMENT"},
                                {"data": "HAS_LOAN"},
                                {"data": "PHONE"},
                                {"data": "PENSION_MODE"},
                                {"data": "PENSIONER_ID",
                                "render": function(data, type, row, meta){
                                var a = '<div class="mr-2">';
<!--                                    if(row.HAS_LOAN === 'Yes'){-->
                                    a+='<a class="btn btn-xs btn-primary" onclick="pensionerLoanRequest(\'' + row.PENSIONER_ID + '\',\'' + row.FULLNAME + '\')"><i class="fa fa-check-circle" aria-hidden="true"> Loan Verification </i></a>';
<!--                                    }-->
<!--                                    a += '&nbsp <a class="btn btn-xs btn-primary"  onclick="pensionerChangeAcct(\'' + row.PENSIONER_ID + '\')"> Change Account</a>';-->
                                    a += '&nbsp <a class="btn btn-xs btn-primary"  onclick="viewPensionerStatement(\'' + row.PENSIONER_ID + '\',\'' + row.SSN + '\',\'' + row.FULLNAME + '\',\'' + row.DOB + '\',\'' + row.RETIREMENT_DATE + '\',\'' + row.MP_AMOUNT + '\',\'' + row.BANK_ACCOUNT + '\',\'' + row.BANK_NAME + '\',\'' + row.PENSIONER_STATUS + '\',\'' + row.STATUS_REASON + '\',\'' + row.PENSIONER_END_DATE + '\',\'' + row.LAST_PAYMENT + '\',\'' + row.HAS_LOAN + '\',\'' + row.PHONE + '\',\'' + row.PENSION_MODE + '\')"><i class="fa fa-eye" aria-hidden="true"> View Statement </i></a>';
                                    a +='</div>';
                                return a;
                                }}
                                ],
                                fnRowCallback: function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                                    if (aData.PENSIONER_STATUS == "Terminated") {
                                        $('td', nRow).css('background-color', 'red');
                                    }
                                }
                            });
                            }else if(response.status == 400){
                                  iziToast.warning({ title: 'Not Found,', message: 'Check Number/ Pension Id Not Found. ',position:'topRight', timeout: 4500 });
                            }else{
                                 iziToast.warning({ title: 'Warning,', message: 'System Failure. ',position:'topRight', timeout: 4500 });
                            }
                            $('#dtableVerificationDiv').show();

                            table.buttons().container().appendTo('#dtableVerification-buttons_wrapper .col-md-6:eq(0)');
                    },
                    error: function (e) {
                        $("#preloader2").hide();
                        console.log(e);
                    }
                });
            }
    </script>
</div>



