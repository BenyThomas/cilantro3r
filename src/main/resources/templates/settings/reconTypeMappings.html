<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/main_layout}">
    <head>
        <title>Recon  & Report Mappings</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

    </head>
    <body>
        <div layout:fragment="pageStyle" th:remove="tag">
            <link th:href="@{/assets/plugins/datatables/jquery.dataTables.min.css}" rel="stylesheet" type="text/css"/>
            <link th:href="@{/assets/plugins/datatables/buttons.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link th:href="@{/assets/plugins/datatables/responsive.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link th:href="@{/assets/plugins/datatables/scroller.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link th:href="@{/assets/plugins/datatables/dataTables.colVis.css}" rel="stylesheet" type="text/css"/>
            <link th:href="@{/assets/plugins/datatables/dataTables.bootstrap.min.css}" rel="stylesheet" type="text/css"/>
            <link th:href="@{/assets/plugins/datatables/fixedColumns.dataTables.min.css}" rel="stylesheet" type="text/css"/>
            <link th:href="@{/assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css}" rel="stylesheet">
        </div>
        <div class="container-fluid" layout:fragment="contents">
            <div class="row p-t-50">
                <div class="col-12">
                    <div class="table-responsive">
                        <div class="panel panel-default panel-fill" id="tabContentsss"><div class="panel-heading"> <h4 class="panel-title">ADD ROLE</h4></div>
                            <div class="panel-body">
                                <form role="form" name="getReconDashboard">
                                    <div class="row">
                                        <div class="form-group col-md-3">
                                            <label for="Name" style="margin-left: 1% ! important;">Recon Code ( TTYPE )</label>
                                            <select class="form-control" id="reconType" selected="selected" name="reconType" style="width: 550px">
                                                <option  value="">Select Txns types......</option>
                                                <option th:each="txn_type: ${reconTypes}" th:value="${txn_type.id}" th:text="${txn_type.name}"> ....  </option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-3" id="reports" hidden="">
                                            <label for="Name" style="margin-left: 1% ! important;">Report Type </label>
                                            <select class="form-control" id="reportType" selected="selected" name="reportType" style="width: 550px">
                                                <option  value="" >Select Report Type</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label for="Name" style="margin-left: 1% ! important;">Display name</label>
                                            <input name="reportName" class="form-control form-control-inline input-txndatemedium default-date-picker"  id="datepicker-autoclose" data-date-format="yyyy-mm-dd" type="text" placeholder="Eg. CBS TRANSACTIONS" autocomplete="off"/>
                                        </div>
                                        <div class="form-group col-md-3" >
                                            <button type="submit" class="btn btn-primary" style="margin: 7%">Submit</button>
                                        </div>
                                    </div>

                                </form>
                                <div class="row" id="loading" hidden=""> 
                                    <img th:src="@{/assets/images/please_wait.gif}" alt="please wait"/>
                                </div>
                                <div class="row" >
                                    <table id="mappedReconReports" class="table table-striped table-bordered"  style="width: 100%; font-size: 11px !important;">
                                        <thead>
                                            <tr>
                                                <th>S/N</th>
                                                <th>Recon Name</th>
                                                <th>Recon Code (TTYPE)</th>
                                                <th>Report Name</th>
                                                <th>Report URL</th>
                                                <th>Display Name</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- container -->

        <!--</body>-->
        <div layout:fragment="pageScript" th:remove="tag">
            <script th:src="@{/assets/plugins/datatables/jquery.dataTables.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.bootstrap.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.buttons.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/buttons.bootstrap.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/jszip.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/pdfmake.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/vfs_fonts.js}"></script>
            <script th:src="@{/assets/plugins/datatables/buttons.html5.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/buttons.print.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.keyTable.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.responsive.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/responsive.bootstrap.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.scroller.min.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.colVis.js}"></script>
            <script th:src="@{/assets/plugins/datatables/dataTables.fixedColumns.min.js}"></script>
            <!-- init -->
            <script th:src="@{/assets/pages/jquery.datatables.init.js}"></script>
            <!-- App Js -->
            <script th:src="@{/assets/js/jquery.app.js}"></script>
            <script th:src="@{/assets/plugins/select2v4/select2.min.js}"></script>
            <script type="text/javascript">
                $(document).ready(function () {
                    //submit the roles

                    $('button[type=submit]').click(function (e) {
                        $('#loading').show();
                        console.log('here we are');
                        e.preventDefault();
                        var reconType = $("select[name='reconType']").val();
                        var reportType = $("select[name='reportType']").val();
                        var reportName = $("input[name='reportName']").val();
                        $.ajax({
                            url: "/saveReconMappings",
                            type: 'GET',
                            data: {reconType: reconType, reportType: reportType, reportName: reportName},
                            dataType: "json",
                            success: function (res) {
                                console.log(res);
                                $('.error').html('');
                                if (res.validated) {
                                    $('#loading').hide();
                                    var i = 0;
                                    $('#mappedReconReports').DataTable({
                                        "info": true,
                                        "bDestroy": true,
                                        dom: "Bfrtip",
                                        "data": res.json2,
                                        "lengthChange": 100,
                                        "columns": [
                                            {"data": 'code',
                                                "render": function (data) {
                                                    i = i + 1;
                                                    return i;
                                                    ;
                                                }},
                                            {"data": "reconName"},
                                            {"data": "ttype"},
                                            {"data": "reportName"},
                                            {"data": "reportUrl"},
                                            {"data": "displayName"},
                                            {data: 'code',
                                                "orderable": false,
                                                "searchable": false,
                                                "render": function (data, type, row, meta) {
                                                    var a = "<a href='#'><i class='fa fa-edit'>Edit</i></a>&nbsp;&nbsp;<a href='#' class='button'><i class='fa fa-trash'>Delete</i></a>";

                                                    return a;
                                                }}
                                        ], buttons: [{
                                                extend: "copy",
                                                title: 'Mapped Recon types with Reports',
                                                className: "btn-sm"
                                            }, {
                                                extend: "csv",
                                                title: 'Mapped Recon types with Reports',
                                                className: "btn-sm"
                                            }, {
                                                extend: "excel",
                                                title: 'Mapped Recon types with Reports',
                                                className: "btn-sm"
                                            }, {
                                                extend: "pdf",
                                                title: 'Mapped Recon types with Reports',
                                                className: "btn-sm"
                                            }, {
                                                extend: "print",
                                                title: 'Mapped Recon types with Reports',
                                                className: "btn-sm"
                                            }],
                                        responsive: !1,
                                    });
                                } else {
                                    $('#preloader2').hide();
                                    $.each(res.errorMessages, function (key, value) {
                                        $('Select[name=' + key + ']').after('<span class="error" style="color:red">' + value + '</span>');
                                        $('input[name=' + key + ']').after('<span class="error" style="color:red">' + value + '</span>');
                                    });
                                }
                            }
                        });
                    });

                    $("#reconType").on('change', function () {
                        var reconType = $("select[name='reconType']").val();

                        $.ajax({
                            url: "/getUnmappedReconTypes",
                            type: 'GET',
                            dataType: "json",
                            data: {reconType: reconType},
                            success: function (response) {
                                $('#reportType').empty();
                                var select2 = document.getElementById('reportType');
                                $.each(response.json, function (key, data) {
                                    var opt = document.createElement('option');
                                    opt.value = data.id;
                                    opt.innerHTML = data.name;
                                    select2.appendChild(opt);
                                });
                                $("#reports").show();
                                //show the mapped reports per that recon type
                                var i = 0;
                                $('#mappedReconReports').DataTable({
                                    "info": true,
                                    "bDestroy": true,
                                    dom: "Bfrtip",
                                    "data": response.json2,
                                    "lengthChange": 100,
                                    "columns": [
                                        {"data": 'code',
                                            "render": function (data) {
                                                i = i + 1;
                                                return i;
                                                ;
                                            }},
                                        {"data": "reconName"},
                                        {"data": "ttype"},
                                        {"data": "reportName"},
                                        {"data": "reportUrl"},
                                        {"data": "displayName"},
                                        {data: 'code',
                                            "orderable": false,
                                            "searchable": false,
                                            "render": function (data, type, row, meta) {
                                                var a = "<a href='#'><i class='fa fa-edit'>Edit</i></a>&nbsp;&nbsp;<a href='#' class='button'><i class='fa fa-trash'>Delete</i></a>";

                                                return a;
                                            }}
                                    ], buttons: [{
                                            extend: "copy",
                                            title: 'Mapped Recon types with Reports',
                                            className: "btn-sm"
                                        }, {
                                            extend: "csv",
                                            title: 'Mapped Recon types with Reports',
                                            className: "btn-sm"
                                        }, {
                                            extend: "excel",
                                            title: 'Mapped Recon types with Reports',
                                            className: "btn-sm"
                                        }, {
                                            extend: "pdf",
                                            title: 'Mapped Recon types with Reports',
                                            className: "btn-sm"
                                        }, {
                                            extend: "print",
                                            title: 'Mapped Recon types with Reports',
                                            className: "btn-sm"
                                        }],
                                    responsive: !1,
                                });
                            },
                            error: function (errorMessage) {
                                console.log(errorMessage);
                                $("#loadings").hide();
                            }

                        });

                    });

                });
            </script>
        </div>

</html>
